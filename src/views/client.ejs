<div class="w-full p-8 space-y-10 font-sans">
  <!-- Header -->
  <h2 class="text-4xl font-bold text-gray-800 text-center">Client Details</h2>

  <!-- Main Grid -->
  <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- QR & Status -->
    <aside class="bg-gray-50 border border-gray-200 rounded-xl p-6 flex flex-col items-center justify-between space-y-4">
      <div class="relative w-80 h-80">
        <img 
          id="qr-<%= client.id %>" 
          class="w-full h-full object-contain opacity-0 transition-opacity" 
          alt="QR Code" 
        />
        <div 
          id="qr-placeholder-<%= client.id %>" 
          class="absolute inset-0 flex items-center justify-center text-gray-400 text-center opacity-75 transition-opacity"
        >
          <span>QR code akan muncul di sini</span>
        </div>
      </div>
      <span id="status-<%= client.id %>" class="px-3 py-1 rounded-full font-medium text-sm transition-colors"></span>
    </aside>

    <!-- Edit Form -->
    <section class="lg:col-span-2 bg-white border border-gray-200 rounded-xl p-8 shadow-sm">
      <form id="edit-form" class="ajax-form space-y-6" action="/clients/<%= client.id %>" method="POST">
        <input type="hidden" name="_method" value="PUT" />

        <div class="space-y-6">
          <!-- Client Name -->
          <div>
            <label for="name" class="block text-sm font-semibold text-gray-700 mb-1">Client Name</label>
            <input
              id="name"
              name="name"
              type="text"
              value="<%= client.name %>"
              required
              class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-indigo-500 focus:border-indigo-500"
            />
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-semibold text-gray-700 mb-1">Description</label>
            <input
              id="description"
              name="description"
              type="text"
              value="<%= client.description || '' %>"
              placeholder="Leave blank to keep current description"
              class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-indigo-500 focus:border-indigo-500"
            />
            <p class="text-xs text-gray-500 mt-1">Leave blank to keep current description.</p>
          </div>

          <!-- Secret Key -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Secret Key</label>
            <div class="flex items-center space-x-2 bg-gray-100 border border-gray-200 rounded-lg px-4 py-2">
              <span class="text-sm text-gray-800 break-all bg-gray-200 py-1 px-2 rounded"><%= client.signatureKey %>:</span>
              <button
                type="button"
                class="text-indigo-600 text-sm rounded focus:outline-none hover:bg-gray-200 px-2 py-1"
                onclick="copyToClipboard('<%= client.secretKey %>')"
              >
                Copy
              </button>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-end pt-4">
          <button
            type="submit"
            class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg font-semibold transition"
          >
            Update
          </button>
        </div>
      </form>
    </section>

  </section>

  <!-- Contacts & Messages Section -->
  <section id="page-data" data-contact-page="<%= contactPage %>" data-contact-total-pages="<%= contactTotalPages %>" class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white border border-gray-200 rounded-xl p-6">
      <div class="flex items-center justify-between mb-4 ">
        <h2 class="text-2xl font-semibold text-gray-700">Contacts</h2>
        <div class="flex gap-1 flex-wrap items-center">
          <% const pageStart = Math.max(1, contactPage - 2); %>
          <% const pageEnd = Math.min(contactTotalPages, pageStart + 4); %>

          <% if (contactPage > 1) { %>
            <a href="?contactPage=<%= contactPage - 1 %>&messagePage=<%= messagePage %>&search=<%= search %>&type=<%= type %>" class="px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200">« Prev</a>
          <% } %>

          <% for (let i = pageStart; i <= pageEnd; i++) { %>
            <a 
              href="?contactPage=<%= i %>&messagePage=<%= messagePage %>&search=<%= search %>&type=<%= type %>" 
              class="px-3 py-1 rounded <%= i === contactPage ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-800 hover:bg-gray-200' %>"
            ><%= i %></a>
          <% } %>

          <% if (contactPage < contactTotalPages) { %>
            <a href="?contactPage=<%= contactPage + 1 %>&messagePage=<%= messagePage %>&search=<%= search %>&type=<%= type %>" class="px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200">Next »</a>
          <% } %>
        </div>  
      </div>

      <!-- Filters & Search -->
      <div class="flex flex-wrap items-start justify-between">
        <div class="flex flex-wrap gap-2 mb-4">
          <% const types = ['all', 'PERSONAL', 'GROUP', 'COMMUNITY']; %>
          <% types.forEach(t => { 
              const isActive = (t === 'all' && !type) || (t === type);
          %>
            <a
              href="?contactPage=1&messagePage=<%= messagePage %>&search=<%= search %>&type=<%= t === 'all' ? '' : t %>"
              class="px-4 py-2 rounded-lg 
                <%= isActive ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300' %>"
            >
              <%= t === 'all' ? 'All' : t.charAt(0) + t.slice(1).toLowerCase() %>
            </a>
          <% }) %>
        </div>

        <form method="GET" class="mb-4 flex gap-2">
          <input 
            name="search"
            value="<%= search %>"
            type="text" 
            placeholder="Search name or phone..."
            class="border px-3 py-2 rounded-lg"
          />
          <input type="hidden" name="contactPage" value="1" />
          <input type="hidden" name="messagePage" value="<%= messagePage %>" />
          <input type="hidden" name="type" value="<%= type %>" />
          <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg">Search</button>
        </form>
      </div>
      

      <!-- List -->
      <div id="contacts-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <% contacts.forEach(contact => { %>
          <div 
            class="contact-card p-4 border rounded-lg shadow-sm transition bg-white"
            data-type="<%= contact.type %>"
          >
            <div class="flex items-center space-x-4">
              <img 
                src="<%= contact.profilePicUrl || 'https://via.placeholder.com/50' %>" 
                alt="Profile Picture" 
                class="w-12 h-12 rounded-full object-cover"
              />
              <div>
                <p class="font-medium text-gray-800"><%= contact.name %></p>
                <p class="text-sm text-gray-600"><%= contact.waId %></p>
                <p class="text-sm text-gray-500"><%= contact.phone %></p>
                <span class="text-xs inline-block mt-1 px-2 py-0.5 bg-gray-100 text-gray-600 rounded"><%= contact.type %></span>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-gray-700">Messages</h2>
        <div class="flex gap-1 flex-wrap items-center">
          <% const msgPageStart = Math.max(1, messagePage - 2); %>
          <% const msgPageEnd = Math.min(messageTotalPages, msgPageStart + 4); %>

          <% if (messagePage > 1) { %>
            <a 
              href="?contactPage=<%= contactPage %>&messagePage=<%= messagePage - 1 %>&search=<%= search %>&type=<%= type %>" 
              class="px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200"
            >« Prev</a>
          <% } %>

          <% for (let i = msgPageStart; i <= msgPageEnd; i++) { %>
            <a 
              href="?contactPage=<%= contactPage %>&messagePage=<%= i %>&search=<%= search %>&type=<%= type %>" 
              class="px-3 py-1 rounded <%= i === messagePage ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-800 hover:bg-gray-200' %>"
            ><%= i %></a>
          <% } %>

          <% if (messagePage < messageTotalPages) { %>
            <a 
              href="?contactPage=<%= contactPage %>&messagePage=<%= messagePage + 1 %>&search=<%= search %>&type=<%= type %>" 
              class="px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200"
            >Next »</a>
          <% } %>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Isi Pesan</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Arah Pesan</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu Diterima</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if (messages.length === 0) { %>
              <tr>
                <td colspan="3" class="px-6 py-4 whitespace-nowrap text-center text-gray-500">Belum ada pesan</td>
              </tr>
            <% } else { %>
              <% messages.forEach(message => { %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700"><%= message.id %></td>
                  <td class="px-6 py-4 whitespace-normal text-sm text-gray-700"><%= message.body %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= message.direction %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <%= new Date(message.createdAt).toLocaleString('id-ID', {
                          day: '2-digit', month: 'short', year: 'numeric',
                          hour: '2-digit', minute: '2-digit'
                        }) %>
                  </td>
                </tr>
              <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Send & Schedule -->
  <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Send -->
    <div class="bg-white border border-gray-200 rounded-xl p-6">
      <h3 class="text-2xl font-semibold mb-4">Kirim Pesan</h3>
      <form id="send-message-form" class="ajax-form space-y-4" action="/clients/<%= client.id %>/messages/send" method="POST">
        <div>
          <label for="to-send" class="block text-gray-700">To (WA ID)</label>
          <input id="to-send" name="to" required class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div>
          <label for="body-send" class="block text-gray-700">Pesan</label>
          <textarea id="body-send" name="body" rows="3" required class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
        </div>
        <button type="submit" class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">Kirim</button>
      </form>
    </div>

    <!-- Schedule -->
    <div class="bg-white border border-gray-200 rounded-xl p-6">
      <h3 class="text-2xl font-semibold mb-4">Jadwalkan Pesan</h3>
      <form id="schedule-message-form" class="ajax-form space-y-4" action="/clients/<%= client.id %>/messages/schedule" method="POST">
        <div>
          <label for="to-sched" class="block text-gray-700">To (WA ID)</label>
          <input id="to-sched" name="to" required class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-yellow-500 focus:border-yellow-500" />
        </div>
        <div>
          <label for="body-sched" class="block text-gray-700">Pesan</label>
          <textarea id="body-sched" name="body" rows="3" required class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-yellow-500 focus:border-yellow-500"></textarea>
        </div>
        <div>
          <label for="scheduledAt" class="block text-gray-700">Waktu</label>
          <input id="scheduledAt" type="datetime-local" name="scheduledAt" required class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-yellow-500 focus:border-yellow-500" />
        </div>
        <button type="submit" class="w-full py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg">Jadwalkan</button>
      </form>
    </div>
  </section>

  <!-- Manage Auto-Reply -->
  <div class="bg-white border border-gray-200 rounded-xl p-6">
    <h3 class="text-2xl font-semibold mb-4">Auto-Reply</h3>
    <form id="auto-reply-form" class="ajax-form space-y-4" action="/clients/<%= client.id %>/auto-reply" method="POST">
      <input type="hidden" name="_method" value="PATCH">
      <div class="flex items-center">
        <input
          id="isReplyPersonal"
          type="checkbox"
          name="isReplyPersonal"
          value="true"
          class="h-5 w-5 text-indigo-600 border-gray-300 rounded"
          <%= client.autoReplies.isReplyPersonal ? 'checked' : '' %>
        />
        <label for="isReplyPersonal" class="ml-2 text-gray-700">Balas Otomatis Personal</label>
      </div>
      <div>
        <label for="replyTemplatePersonal" class="block text-gray-700">Template Personal</label>
        <textarea
          id="replyTemplatePersonal"
          name="replyTemplatePersonal"
          rows="2"
          <%= client.autoReplies.isReplyPersonal ? '' : 'disabled' %>
          class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500"
        ><%= client.autoReplies.replyTemplatePersonal || '' %></textarea>
      </div>
      <div class="flex items-center">
        <input
          id="isReplyGroup"
          type="checkbox"
          name="isReplyGroup"
          value="true"
          class="h-5 w-5 text-indigo-600 border-gray-300 rounded"
          <%= client.autoReplies.isReplyGroup ? 'checked' : '' %>
        />
        <label for="isReplyGroup" class="ml-2 text-gray-700">Balas Otomatis di Grup</label>
      </div>
      <div>
        <label for="replyTemplateGroup" class="block text-gray-700">Template Grup</label>
        <textarea
          id="replyTemplateGroup"
          name="replyTemplateGroup"
          rows="2"
          <%= client.autoReplies.isReplyGroup ? '' : 'disabled' %>
          class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500"
        ><%= client.autoReplies.replyTemplateGroup || '' %></textarea>
      </div>
      <div class="flex items-center">
        <input
          id="isReplyTag"
          type="checkbox"
          name="isReplyTag"
          value="true"
          class="h-5 w-5 text-indigo-600 border-gray-300 rounded"
          <%= client.autoReplies.isReplyTag ? 'checked' : '' %>
        />
        <label for="isReplyTag" class="ml-2 text-gray-700">Balas Saat Ditag di Grup</label>
      </div>
      <div>
        <label for="replyTemplateTag" class="block text-gray-700">Template Mention Grup</label>
        <textarea
          id="replyTemplateTag"
          name="replyTemplateTag"
          rows="2"
          <%= client.autoReplies.isReplyTag ? '' : 'disabled' %>
          class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500"
        ><%= client.autoReplies.replyTemplateTag || '' %></textarea>
      </div>
      <button type="submit" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg">Simpan Auto-Reply</button>
    </form>
  </div>

  <!-- Manage Webhooks -->
  <section class="mt-10 bg-white border border-gray-200 rounded-xl p-6">
    <h3 class="text-2xl font-semibold mb-4">Manage Webhooks</h3>
    <div class="overflow-x-auto mb-6 border-b border-gray-200 pb-4 w-full">
      <form
        id="new-webhook-form"
        class="ajax-form flex flex-nowrap items-end items-center justify-between space-x-4"
        action="/clients/<%= client.id %>/webhook"
        method="POST"
      >
        <input type="hidden" name="_method" value="POST">

        <!-- URL Webhook -->
        <div class="flex-shrink-0 w-64">
          <label for="new-url" class="block text-gray-700">URL Webhook</label>
          <input
            id="new-url"
            name="url"
            placeholder="https://example.com/webhook"
            required
            class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-purple-500 focus:border-purple-500"
          />
        </div>

        <!-- Name -->
        <div class="flex-shrink-0 w-48">
          <label for="new-name" class="block text-gray-700">Name</label>
          <input
            id="new-name"
            name="name"
            type="text"
            placeholder="Webhook Name"
            class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-purple-500 focus:border-purple-500"
          />
        </div>

        <!-- Description -->
        <div class="flex-shrink-0 w-56">
          <label for="new-description" class="block text-gray-700">Description</label>
          <input
            id="new-description"
            name="description"
            type="text"
            placeholder="Deskripsi singkat"
            class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-purple-500 focus:border-purple-500"
          />
        </div>

        <!-- Signature Header -->
        <div class="flex-shrink-0 w-48">
          <label for="new-signatureHeader" class="block text-gray-700">Signature Header</label>
          <input
            id="new-signatureHeader"
            name="signatureHeader"
            type="text"
            placeholder="X-Signature"
            class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-purple-500 focus:border-purple-500"
          />
        </div>

        <!-- Checkboxes -->
        <div class="flex space-x-6">
          <label class="flex items-center space-x-1">
            <input id="new-isPersonal" name="isPersonal" type="checkbox" value="true" class="h-5 w-5 text-indigo-600 rounded" />
            <span class="text-gray-700">Personal</span>
          </label>
          <label class="flex items-center space-x-1">
            <input id="new-isGroup" name="isGroup" type="checkbox" value="true" class="h-5 w-5 text-indigo-600 rounded" />
            <span class="text-gray-700">Group</span>
          </label>
          <label class="flex items-center space-x-1">
            <input id="new-isTag" name="isTag" type="checkbox" value="true" class="h-5 w-5 text-indigo-600 rounded" />
            <span class="text-gray-700">Tag</span>
          </label>
        </div>

        <!-- Submit Button -->
        <div class="flex-shrink-0">
          <button
            type="submit"
            class="ml-4 py-2 px-6 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium"
          >
            Tambah Webhook
          </button>
        </div>
      </form>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">URL</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Desc</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Secret Key</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Signature Header</th>
            <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Personal</th>
            <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Group</th>
            <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Tag</th>
            <th class="px-4 py-2 text-right"></th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% if (client.webhooks.length === 0) { %>
            <tr>
              <td colspan="10" class="px-4 py-4 text-center text-gray-500">Belum ada webhook</td>
            </tr>
          <% } else { %>
            <% client.webhooks.forEach(wh => { %>
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700"><%= wh.id %></td>
                <form class="ajax-form flex w-full" action="/clients/webhook/<%= wh.id %>" method="POST">
                  <input type="hidden" name="_method" value="PUT">
                  <td class="px-4 py-2 w-64"><input name="url" value="<%= wh.url %>" required class="w-full border-gray-300 rounded-lg px-2 py-1" /></td>
                  <td class="px-4 py-2 w-48"><input name="name" type="text" value="<%= wh.name %>" class="w-full border-gray-300 rounded-lg px-2 py-1" /></td>
                  <td class="px-4 py-2 w-56"><input name="description" type="text" value="<%= wh.description %>" class="w-full border-gray-300 rounded-lg px-2 py-1" /></td>
                  <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700"><%= wh.secretKey %></td>
                  <td class="px-4 py-2 w-48"><input name="signatureHeader" type="text" value="<%= wh.signatureHeader %>" class="w-full border-gray-300 rounded-lg px-2 py-1" /></td>
                  <td class="px-4 py-2 text-center"><input name="isPersonal" type="checkbox" value="true" <%= wh.isPersonal ? 'checked' : '' %> class="h-4 w-4 text-indigo-600" /></td>
                  <td class="px-4 py-2 text-center"><input name="isGroup" type="checkbox" value="true" <%= wh.isGroup ? 'checked' : '' %> class="h-4 w-4 text-indigo-600" /></td>
                  <td class="px-4 py-2 text-center"><input name="isTag" type="checkbox" value="true" <%= wh.isTag ? 'checked' : '' %> class="h-4 w-4 text-indigo-600" /></td>
                  <td class="px-4 py-2 text-right flex space-x-2">
                    <button type="submit" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">Save</button>
                    </form>
                    <form class="ajax-form" action="/clients/webhook/<%= wh.id %>" method="POST">
                      <input type="hidden" name="_method" value="DELETE">
                      <button type="submit" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm">Delete</button>
                    </form>
                  </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </section>

  <script>
    function copyToClipboard(text) {
      // Gunakan Clipboard API jika tersedia
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          alert('Copied to clipboard!');
        }).catch(err => {
          console.error('Could not copy text: ', err);
        });
      } else {
        // Fallback untuk browser lama
        const tempInput = document.createElement("input");
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert('Copied to clipboard!');
      }
    }

    // Initialize page data from server-side variables
    document.addEventListener('DOMContentLoaded', () => {
      const pageEl = document.getElementById('page-data');
      if (!pageEl) {
        console.warn("❌ Elemen #page-data tidak ditemukan di DOM");
        return;
      }

      const contactPage = parseInt(pageEl.dataset.contactPage || "1");
      const contactTotalPages = parseInt(pageEl.dataset.contactTotalPages || "1");
      const pageStart = Math.max(1, contactPage - 2);
      const pageEnd = Math.min(contactTotalPages, pageStart + 4);
    });

    // Toggle textarea disable state based on checkbox
    document.addEventListener("DOMContentLoaded", function () {
      // Daftar pasangan ID checkbox dan ID textarea
      const pairs = [
        { checkboxId: "isReplyPersonal", textareaId: "replyTemplatePersonal" },
        { checkboxId: "isReplyGroup", textareaId: "replyTemplateGroup" },
        { checkboxId: "isReplyTag", textareaId: "replyTemplateTag" },
      ];

      pairs.forEach(({ checkboxId, textareaId }) => {
        const checkbox = document.getElementById(checkboxId);
        const textarea = document.getElementById(textareaId);

        // Fungsi untuk toggle disable textarea
        const toggleTextarea = () => {
          textarea.disabled = !checkbox.checked;
        };

        // Inisialisasi kondisi saat halaman dimuat
        toggleTextarea();

        // Tambahkan event listener saat checkbox berubah
        checkbox.addEventListener("change", toggleTextarea);
      });
    });

    // Handle QR code generation and AJAX form submission
    document.addEventListener('DOMContentLoaded', () => {
      const socket = io();
      socket.on("status", ({ clientId, status }) => {
        const td = document.getElementById(`status-${clientId}`);
        if (td) {
          td.textContent = status;
          // Reset all status-related classes
          td.classList.remove(
            'bg-green-100', 'text-green-800',
            'bg-yellow-100', 'text-yellow-800',
            'bg-red-100', 'text-red-800'
          );
          
          // Tambahkan class berdasarkan status
          if (status === "CONNECTED") {
            td.classList.add('bg-green-100', 'text-green-800');
          } else if (status === "SCANNING") {
            td.classList.add('bg-yellow-100', 'text-yellow-800');
          } else if (status === "DISCONNECTED") {
            td.classList.add('bg-red-100', 'text-red-800');
          }
        }
      });
      socket.on('qr', ({ clientId, qr }) => {
        const img = document.getElementById(`qr-${clientId}`);
        const placeholder = document.getElementById(`qr-placeholder-${clientId}`);
        img.src = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(qr)}&size=500x500`;
        placeholder.classList.add('hidden');
        img.classList.remove('opacity-0');
      });

      // Attach AJAX handler to all forms with class "ajax-form"
      document.querySelectorAll('form.ajax-form').forEach(form => {
        form.addEventListener('submit', async e => {
          e.preventDefault();
          const formData = new FormData(form);
          const method = (formData.get('_method') || form.method).toUpperCase();
          formData.delete('_method');
          const payload = Object.fromEntries(formData.entries());

          // Special handling for auto-reply checkboxes
          if (form.id === 'auto-reply-form') {
            ['Personal','Group','Tag'].forEach(type => {
              payload[`isReply${type}`] = !!form.querySelector(`#isReply${type}`).checked;
            });
          }

          try {
            const res = await fetch(form.action, {
              method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
            });
            if (res.ok) {
              alert('✅ Berhasil!');
            } else {
              console.error(await res.text());
              alert('❌ Gagal!');
            }
          } catch (err) {
            console.error(err);
            alert('❌ Gagal!');
          }
        });
      });
    });
  </script>
</div>
